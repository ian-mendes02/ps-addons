!function(m,h,w){m("tr[data-discount-id]").each(function(){let e=m(this),o="edit"==e.attr("data-row-action"),t=o?e.attr("data-discount-id"):"ps-new-discount",d=o?h.find(i=>i.id==t):null,a="inline-edit-"+t,n={edit:e.find("a[data-action=edit]"),copy:e.find("a[data-action=copy]"),delete:e.find("a[data-action=delete]"),toggle:e.find('[name="discount_active"]')};function c(i){if(0==i.slice(-1))return JSON.parse(i.slice(0,-1))}function s(){for(var i=m(this).closest("li"),t=i.attr("id"),n=0;n<window.ps_included_products.length;n++)window.ps_included_products[n].id==t&&(window.ps_included_products.splice(n,1),i.remove())}function l(i){var n,e,o=m("#"+a).find("ul.ps-selected-products");for(let t of i)window.ps_included_products.find(i=>i.id==t.id)||(n=m(`<li class='ps-included-product' id="${t.id}"><span>${t.name}</span></li>`),e=m('<span class="ps-remove-selected-product"></span>').on("click",s),o.append(n.prepend(e)),window.ps_included_products.push(t))}function u(){var i=m(this).val(),n=m(`#${a} .ps-products-dropdown`),t={action:"product_lookup",query:i,limit:5};n.hide(),2<i.length&&m.post(w,t,function(i){if(console.log(c(i)),i&&0!=i.length){var t;for(t of c(i))n.append(function(i){return m(`<li class='ps-list-item ps-product-option' data-product-id="${i.id}">${i.name}</li>`).on("click",()=>l([i]))}(t));n.show()}})}function p(){var i=m("#"+a),i={id:t,name:i.find('[name="discount_name"]').val(),type:i.find('[name="discount_type"]').val(),value:i.find('[name="discount_value"]').val(),schedule:i.find('[name="expires_on"]').val().replace("T"," "),is_active:!o||n.toggle.hasClass("active")?1:0,priority:i.find('[name="discount_priority"]').val(),included_products:window.ps_included_products};i.name&&""!=i.name?m.post(w,{action:"submit_discount",data:i},function(i){i=c(i);1==i?location.reload():"error"==i.status&&console.log(i.message)}):alert("O campo 'Nome' não pode ficar em branco.")}function r(){m("#ps-new-discount-header").remove(),m("#"+a).siblings("tr.hidden").addBack().remove(),e.show()}function i(){m("tr[data-discount-id]").each(function(){var i=m(this);m('[id^="inline-edit-"]').siblings("tr.hidden").addBack().remove(),i.show(),i.removeClass("active")}),window.ps_included_products=[],e.addClass("active");var i=m("#ps-inline-edit").clone(!0),t={name:i.find('[name="discount_name"]'),type:i.find('[name="discount_type"]'),value:i.find('[name="discount_value"]'),schedule:i.find('[name="expires_on"]'),included_products:i.find("ul.ps-selected-products"),priority:i.find('[name="discount_priority"]'),product_lookup:i.find('[name="product_name"]'),save:i.find("[data-action=save]"),cancel:i.find("[data-action=cancel]")},n=(e.hide().after(i).after('<tr class="hidden"></tr>'),o||e.before(m('<h2 id="ps-new-discount-header">Novo Desconto</h2>')),i.attr("id",a),i.find("td").attr("colspan",m("#ps-discounts-list-table thead th").length),o&&(t.name.val(d.name),t.type.find(`option[value="${d.type}"]`).attr("selected","selected"),t.value.val(d.value),t.priority.val(d.priority),t.schedule.val(d.expires_on.split(" ")[0])),t.save.on("click",p),t.cancel.on("click",r),m(`#${a} .ps-products-dropdown`));t.product_lookup.on("input",u),t.product_lookup.on("focus",()=>n.show()),m(document).on("click",function(i){m(i.target).parent().is(n)||m(i.target).is(t.product_lookup)||m(i.target).is(n)||(n.hide(),t.product_lookup.val(""))}),o&&l(d.included_products)}function f(){var i={action:"duplicate_discount",id:t};m.post(w,i,()=>location.reload())}function _(){var i;confirm("Excluir o item?\n(Essa ação não pode ser desfeita)")&&(i={action:"delete_discount",id:t},m.post(w,i,()=>location.reload()))}function v(){m(this).toggleClass("active"),m.post(w,{action:"update_discount_status",id:t,is_active:m(this).hasClass("active")?1:0})}n.copy.on("click",f),n.edit.on("click",i),n.delete.on("click",_),n.toggle.on("click",v)}),m(".ps-tooltip").on("mouseenter",function(){m(this).find("p").show()}),m(".ps-tooltip").on("mouseleave",function(){m(this).find("p").hide()})}(jQuery,ps_ajax.discount_data,ps_ajax.ajax_url);