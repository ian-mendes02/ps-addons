!function(y,e,g,k){window.ps??={},window.ps.inline_edit={},y("tr[data-discount-id]").each(function(){let d=y(this),o="edit"==d.attr("data-row-action"),n=o?d.attr("data-discount-id"):"ps-new-discount",s=o?e.find(e=>e.id==n):null,c="inline-edit-"+n,i={edit:d.find("a[data-action=edit]"),copy:d.find("a[data-action=copy]"),delete:d.find("a[data-action=delete]"),toggle:d.find('[name="discount_active"]')},a=e=>0==e.slice(-1)&&JSON.parse(e.slice(0,-1)),t=(e,i)=>JSON.stringify(e)==JSON.stringify(i);function l(e=24,i=""){return`<img 
                src='${k}' 
                width='${e}px' 
                height='${e}px'
                class='${i}'
                draggable='false' 
            />`}function p(){window.ps.inline_edit.data=w();var e=y("#"+c).find("[data-action=save]"),i=window.ps.inline_edit,i=!t(i._data,i.data);return i?e.removeClass("ps-disabled"):e.addClass("ps-disabled"),i}function r(){for(var e=y(this).closest("li"),i=e.attr("id"),n=window.ps.inline_edit.data.included_products,t=0;t<n.length;t++)n[t].id==i&&(window.ps.inline_edit.data.included_products.splice(t,1),e.remove(),p())}function u(e){var n,t=y("#"+c).find("ul.ps-selected-products");for(let i of e)window.ps.inline_edit.included_products.find(e=>e.id==i.id)||(n='<li class="ps-included-product" id="'+i.id+'"><span>'+i.name+"</span></li>",t.append(y(n).prepend(y('<span class="ps-remove-selected-product"></span>').on("click",r))),window.ps.inline_edit.included_products.push(i));p()}function f(){var n,e=y(this).val(),t=y("#"+c+" .ps-products-dropdown");e.length<2?t.empty().hide():(e={action:"product_lookup",query:e,limit:5},t.show().html(`<span class="ps-full ps-center">${l()}</span>`),y.post(g,e,function(e){if(e&&0!=e.length){n=a(e),t.empty();for(var i of n)t.append(function(e){var i='<li class="ps-list-item ps-product-option" data-product-id="'+e.id+'">'+e.name+"</li>";return y(i).on("click",()=>u([e]))}(i))}else 0==e.length&&t.empty()}))}let v=e=>{"Enter"==e.key&&m(),"Escape"==e.key&&h()};function m(){var e;p()&&(y(l()).insertBefore(y(this)),(e=window.ps.inline_edit.data).is_active=!o||i.toggle.hasClass("active")?1:0,e.name&&""!=e.name?y.post(g,{action:"submit_discount",data:e},function(e){e=a(e);1!=e?"error"==e.status&&alert(e.message):location.reload()}):alert("O campo 'Nome' não pode ficar em branco."))}function h(){y(document).off("keydown",v),y("#ps-new-discount-header").remove(),y("#"+c).siblings("tr.hidden").addBack().remove(),d.show()}function _(){var e=y("#"+c);return window.ps.inline_edit.fields??={name:e.find('[name="discount_name"]'),type:e.find('[name="discount_type"]'),value:e.find('[name="discount_value"]'),schedule:e.find('[name="discount_expires_on"]'),priority:e.find('[name="discount_priority"]')},window.ps.inline_edit.fields}function w(){var e=_();return{id:n,name:e.name.val(),type:e.type.val(),value:e.value.val(),schedule:e.schedule.val().replace("T"," "),priority:e.priority.val(),included_products:window.ps.inline_edit.included_products}}i.copy.on("click",function(){var e=y(this).parent(),i=y(l(12));e.append(i),y.post(g,{action:"duplicate_discount",id:n},()=>{e.remove(),location.reload()}).catch(()=>e.remove())}),i.edit.on("click",function(){y("tr[data-discount-id]").each(function(){y('[id^="inline-edit-"]').siblings("tr.hidden").addBack().remove(),y(this).show().removeClass("active")}),window.ps.inline_edit={},window.ps.inline_edit.included_products=[],d.addClass("active");var e=y("#ps-inline-edit").clone(!0),i=(d.hide().after(e).after('<tr class="hidden"></tr>'),o||d.before(y('<h2 id="ps-new-discount-header">Novo Desconto</h2>')),e.attr("id",c),e.find("td").attr("colspan",y("#ps-discounts-list-table thead th").length),_()),n=(o&&(i.name.val(s.name),i.type.find(`option[value="${s.type}"]`).attr("selected","selected"),i.value.val(s.value),i.priority.val(s.priority),i.schedule.val(s.expires_on.replace(" ","T"))),e.find(".ps-products-dropdown")),t=e.find('[name="product_name"]'),a=(e.find("input[name]:not(.product-name-input)").on("input",p),e.find("select").on("change",p),t.on("input",f),t.on("focus",()=>n.show()),i.type.on("change",function(){"percent"!=y(this).val()?i.value.attr("max",""):(100<i.value.val()&&i.value.val(100),i.value.attr("max","100"))}),i.value.on("change",function(){var e=y(this);"percent"==i.type.val()&&100<e.val()&&e.val(100)}),y(document).on("click",e=>{e=y(e.target);e.parent().is(n)||e.is(t)||e.is(n)||(n.hide(),t.val(""))}),o?s.included_products:[]);window.ps.inline_edit._data=w(),u(window.ps.inline_edit._data.included_products=a),e.find("[data-action=save]").on("click",m),e.find("[data-action=cancel]").on("click",h),y(document).on("keydown",v)}),i.delete.on("click",function(){var e=y(this).parent(),i=y(l(12));confirm(`Excluir o item '${s.name}'?
(Essa ação não pode ser desfeita)`)&&(e.append(i),i={action:"delete_discount",id:n},y.post(g,i,()=>{e.remove(),location.reload()}).catch(()=>e.remove()))}),i.toggle.on("click",function(){var e=y(this),i=y(`<span class='ps-append-left'>${l(16)}</span>`);e.parent().append(i),y.post(g,{action:"update_discount_status",id:n,is_active:e.hasClass("active")?0:1},()=>{e.toggleClass("active"),i.remove()}).catch(()=>i.remove())})}),y(".ps-tooltip").on("mouseenter",function(){y(this).find("p").show()}),y(".ps-tooltip").on("mouseleave",function(){y(this).find("p").hide()})}(jQuery,ps_ajax.discount_data,ps_ajax.ajax_url,ps_ajax.loading_url);